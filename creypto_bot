import requests
from bs4 import BeautifulSoup
from telegram import Bot
import schedule
import time
import os

# Ø¯Ø±ÛŒØ§ÙØª ØªÙˆÚ©Ù† Ùˆ Ù†Ø§Ù… Ú©Ø§Ù†Ø§Ù„ Ø§Ø² Ù…Ø­ÛŒØ· (Ø¨Ø±Ø§ÛŒ Ø§Ù…Ù†ÛŒØª Ø¨ÛŒØ´ØªØ±)
BOT_TOKEN = os.getenv('BOT_TOKEN')
CHANNEL_USERNAME = os.getenv('CHANNEL_USERNAME')

def get_selected_data():
    url = 'https://www.bonbast.com'
    response = requests.get(url)
    soup = BeautifulSoup(response.text, 'html.parser')

    # Ù„ÛŒØ³Øª ÙØ§Ø±Ø³ÛŒ Ù…ÙˆØ§Ø±Ø¯ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø¨Ø§ Ø§ÛŒÙ…ÙˆØ¬ÛŒ
    targets = {
        'Ø¯Ù„Ø§Ø± Ø¢Ù…Ø±ÛŒÚ©Ø§': 'ðŸ’µ',
        'Ø¨ÛŒØªâ€ŒÚ©ÙˆÛŒÙ†': 'ðŸª™',
        'ØªØªØ±': 'ðŸ’³',
        'Ø³Ú©Ù‡ Ø§Ù…Ø§Ù…ÛŒ': 'ðŸ…',
        'Ù†ÛŒÙ… Ø³Ú©Ù‡': 'ðŸ¥ˆ',
        'Ø±Ø¨Ø¹ Ø³Ú©Ù‡': 'ðŸ¥‰',
        'Ø·Ù„Ø§ Û±Û¸ Ø¹ÛŒØ§Ø±': 'ðŸ”¸',
        'ÛŒÙˆØ±Ùˆ': 'ðŸŒ',
        'Ù¾ÙˆÙ†Ø¯': 'ðŸ‡¬ðŸ‡§',
        'Ø¯Ø±Ù‡Ù… Ø§Ù…Ø§Ø±Ø§Øª': 'ðŸ‡¦ðŸ‡ª'
    }

    result = 'ðŸ“Š Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ù†ØªØ®Ø¨ Ø¨Ø§Ø²Ø§Ø± Ø§Ø±Ø² Ùˆ Ø·Ù„Ø§:\n\n'

    for row in soup.find_all('tr'):
        cells = row.find_all('td')
        if len(cells) >= 2:
            name = cells[0].text.strip()
            price = cells[1].text.strip()
            for target_name, emoji in targets.items():
                if target_name in name:
                    result += f'{emoji} {name}: {price} Ø±ÛŒØ§Ù„\n'

    result += '\n#Ø¯Ù„Ø§Ø± #Ø¨ÛŒØªÚ©ÙˆÛŒÙ† #ØªØªØ± #Ø³Ú©Ù‡ #Ø·Ù„Ø§ #ÛŒÙˆØ±Ùˆ #Ù¾ÙˆÙ†Ø¯ #Ø¯Ø±Ù‡Ù… #Ø§Ø±Ø²Ø¯ÛŒØ¬ÛŒØªØ§Ù„ #Ø¨Ø§Ø²Ø§Ø± #Ø§Ù‚ØªØµØ§Ø¯ #Ù‚ÛŒÙ…Øª_Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ #ØªØ­Ù„ÛŒÙ„_Ø¨Ø§Ø²Ø§Ø± #Ù…Ø§Ù„ÛŒ #Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ #Ú©Ø±ÛŒÙ¾ØªÙˆ #Ø±Ù…Ø²Ø§Ø±Ø² #Ø¨ÙˆØ±Ø³ #Ø±ÛŒØ§Ù„ #Ø§Ø±Ø² #Ø·Ù„Ø§_Ùˆ_Ø³Ú©Ù‡ #Ø³Ú©Ù‡_Ø§Ù…Ø§Ù…ÛŒ #Ù†ÛŒÙ…_Ø³Ú©Ù‡ #Ø±Ø¨Ø¹_Ø³Ú©Ù‡ #Ø·Ù„Ø§Û±Û¸Ø¹ÛŒØ§Ø±'
    return result

def send_to_channel():
    bot = Bot(token=BOT_TOKEN)
    message = get_selected_data()
    bot.send_message(chat_id=CHANNEL_USERNAME, text=message)

# Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ù‡Ø± Û±Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡
schedule.every(15).minutes.do(send_to_channel)

# Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø§Ø¦Ù…ÛŒ
while True:
    schedule.run_pending()
    time.sleep(1)
